package com.infinity.wefriends;

import com.infinity.wefriends.apis.Users;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.widget.Toast;

public class AsyncConnTask {
	Users users = null;
	Context m_context = null;
	
	public AsyncConnTask(Context context) {
		m_context = context;
		users = new Users(context);
	}
	
	public void initCheckUserInfo() {
		Thread thread = new initUserCheckThread();
		thread.start();
	}
	
	protected class initUserCheckThread extends Thread {
		@Override
		public void run() {
			if (users.authenticateCachedAccessToken()==Users.TOKEN_INVALID) {
				Intent intent = new Intent();
				intent.setClass(AsyncConnTask.this.m_context,LoginActivity.class);
				AsyncConnTask.this.m_context.startActivity(intent);
				((MainActivity)AsyncConnTask.this.m_context).finish();
			} else {
				((MainActivity)AsyncConnTask.this.m_context).loadAllData();
			}
			super.run();
		}
	}
	
	protected class loginThread extends Thread {
		protected String m_phone,m_password;
		protected Activity m_loginActivity;
		public loginThread(String phone, String password, Activity loginActivity) {
			m_phone = phone;
			m_password = password;
			m_loginActivity = loginActivity;
		}
		@Override
		public void run() {
			int result = users.login(m_phone, m_password);
			switch(result) {
			case Users.LOGIN_OK:
				Intent intent = new Intent();
				intent.setClass(m_loginActivity, MainActivity.class);
				m_loginActivity.startActivity(intent);
				m_loginActivity.finish();
				break;
			case Users.LOGIN_FAILED:
				Toast.makeText(m_loginActivity, R.string.login_failed, Toast.LENGTH_SHORT).show();
				break;
			case Users.CONNECTION_ERROR:
				Toast.makeText(m_loginActivity, R.string.connection_error, Toast.LENGTH_SHORT).show();
				break;
			}
			super.run();
		}
		
	}

}
